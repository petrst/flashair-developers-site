<!DOCTYPE html>
<html dir="ltr" lang="en">

<head>

    <meta charset="utf-8">
<!-- %meta{:content => "IE=edge,chrome=1", "http-equiv" => "X-UA-Compatible"} -->

<!--Google Apps verification-->

<title>FlashAir Developers - Uploading to Facebook</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<meta property="fb:admins" content="100006082240886">

<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@FlashAirDev">
<meta property="fb:admins" content="115819238627364">
<meta property="og:site_name" content="FlashAir Developers">
<meta property="og:image" content="https://flashair-developers.com/images/assets/ogp.png">
<meta property="og:url" content="https://flashair-developers.com/en/documents/tutorials/lua/5/">
<meta property="og:type" content="article">
<meta property="og:title" content="FlashAir Developers - Uploading to Facebook">

<link href="..\..\..\..\..\images\flashair_favicon.ico" rel="shortcut icon">
<link href="..\..\..\..\..\images\apple-touch-icon-152x152-precomposed.png" rel="apple-touch-icon-precomposed" sizes="152x152">
<link href="..\..\..\..\..\images\apple-touch-icon-120x120-precomposed.png" rel="apple-touch-icon-precomposed" sizes="120x120">
<link href="..\..\..\..\..\images\apple-touch-icon-114x114-precomposed.png" rel="apple-touch-icon-precomposed" sizes="114x114">
<link href="..\..\..\..\..\images\apple-touch-icon-76x76-precomposed.png" rel="apple-touch-icon-precomposed" sizes="76x76">
<link href="..\..\..\..\..\images\apple-touch-icon-72x72-precomposed.png" rel="apple-touch-icon-precomposed" sizes="72x72">
<link href="..\..\..\..\..\images\apple-touch-icon-57x57-precomposed.png" rel="apple-touch-icon-precomposed" sizes="57x57">
<!-- Web Fonts -->
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Raleway:300,400,700" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Pacifico" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=PT+Serif" rel="stylesheet">

<!-- Bootstrap core CSS -->
<link href="..\..\..\..\..\css\bootstrap.css" rel="stylesheet">

<!-- Font Awesome CSS -->
<link href="..\..\..\..\..\css\fonts\font-awesome\css\font-awesome.css" rel="stylesheet">

<!-- Plugins -->
<link href="..\..\..\..\..\css\magnific-popup.css" rel="stylesheet">
<link href="..\..\..\..\..\css\settings.css" rel="stylesheet">
<link href="..\..\..\..\..\css\layers.css" rel="stylesheet">
<link href="..\..\..\..\..\css\navigation.css" rel="stylesheet">
<link href="..\..\..\..\..\css\animations.css" rel="stylesheet">
<link href="..\..\..\..\..\css\slick.css" rel="stylesheet">

<!-- The Project's core CSS file -->
<!-- Use css/rtl_style.css for RTL version -->
<link href="..\..\..\..\..\css\style.css" rel="stylesheet">
<!-- The Project's Typography CSS file, includes used fonts -->
<!-- Used font for body: Roboto -->
<!-- Used font for headings: Raleway -->
<!-- Use css/rtl_typography-default.css for RTL version -->
<link href="..\..\..\..\..\css\typography-default.css" rel="stylesheet">
<!-- Color Scheme (In order to change the color scheme, replace the blue.css with the color scheme that you prefer) -->
<link href="..\..\..\..\..\css\light_blue.css" rel="stylesheet">

<!-- Custom css -->
<link href="..\..\..\..\..\css\custom.css" rel="stylesheet">
<link href="..\..\..\..\..\css\prettify.css" rel="stylesheet">
<!--[if lt IE 9]>
	<link href="/css/bootstrap-ie6.css" rel="stylesheet" type="text/css" />
<![endif]-->

    <meta name="keywords" content="FlashAir, Lua, app, application, WevDev, HTTP, FTP">
    <meta name="description" content="Tutorials for Lua application. FlashAir is a SD card with embedded wireless LAN produced by Toshiba Memory Corp..">
    <meta property="og:description" content="Tutorials for Lua application. FlashAir is a SD card with embedded wireless LAN produced by Toshiba Memory Corp..">
</head>

<body class=" ">

    <!-- scrollToTop -->
    <!-- ================ -->
    <div class="scrollToTop circle">
        <i class="fa fa-angle-up"></i>
    </div>

    <!-- page wrapper start -->
    <!-- ================ -->
    <div class="page-wrapper">
        <!-- header-container start -->
        <div class="header-container">
            <!-- header-top start -->
<!-- classes:  -->
<!-- "dark": dark version of header top e.g. class="header-top dark" -->
<!-- "colored": colored version of header top e.g. class="header-top colored" -->
<!-- ================ -->
<div class="header-top dark">
    <div class="container">
        <div class="row">
            <div class="col-6 col-sm-6 col-lg-10">
                <div class="header-top-first clearfix">
                    <ul class="list-inline float-right">
                        <li class="list-inline-item">
                            <a href="..\..\..\..\index.htm" id="go-to-japanese">Japanese</a>&nbsp;&nbsp;&nbsp;/</li>
                        <li class="list-inline-item">
                            English&nbsp;&nbsp;&nbsp;/</li>
                        <li class="list-inline-item">
                            <a href="..\..\..\..\..\zh\index.htm" id="go-to-chinese">Chinese</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-6 col-sm-6 col-lg-2">
                <!-- header-top-second start -->
                <!-- ================ -->
                <div id="header-top-second" class="clearfix">
                    <!-- header top dropdowns start -->
                    <!-- ================ -->
                    <div class="header-top-dropdown text-right">
                        <div class="btn-group">
                            <a href="..\..\..\..\member\index.htm" class="btn btn-default btn-sm">
                                <i class="fa fa-user pr-2"></i> MyAccount</a>
                        </div>
                    </div>
                    <!--  header top dropdowns end -->
                </div>
                <!-- header-top-second end -->
            </div>
        </div>
    </div>
</div>
<!-- header-top end -->
<!-- header start -->
<!-- classes:  -->
<!-- "fixed": enables fixed navigation mode (sticky menu) e.g. class="header fixed clearfix" -->
<!-- "fixed-desktop": enables fixed navigation only for desktop devices e.g. class="header fixed fixed-desktop clearfix" -->
<!-- "fixed-all": enables fixed navigation only for all devices desktop and mobile e.g. class="header fixed fixed-desktop clearfix" -->
<!-- "dark": dark version of header e.g. class="header dark clearfix" -->
<!-- "centered": mandatory class for the centered logo layout -->
<!-- ================ -->
<header class="header fixed fixed-desktop clearfix">
    <div class="container">
        <div class="row">
            <div class="col-md-auto hidden-md-down pl-3">
                <!-- header-first start -->
                <!-- ================ -->
                <div class="header-first clearfix">

                    <!-- logo -->
                    <div id="logo" class="logo">
                        <a href="..\..\..\..\index.htm">
                            <img alt="FlashAir logo" src="..\..\..\..\..\images\assets\flashairLogo_official_small2.png">
                            &nbsp;FlashAir&trade; Developers
                        </a>
                    </div>

                </div>
                <!-- header-first end -->

            </div>
            <div class="col-lg-7 ml-lg-auto">

                <!-- header-second start -->
                <!-- ================ -->
                <div class="header-second clearfix">

                    <!-- main-navigation start -->
                    <!-- classes: -->
                    <!-- "onclick": Makes the dropdowns open on click, this the default bootstrap behavior e.g. class="main-navigation onclick" -->
                    <!-- "animated": Enables animations on dropdowns opening e.g. class="main-navigation animated" -->
                    <!-- ================ -->
                    <div class="main-navigation main-navigation--mega-menu  animated">
                        <nav class="navbar navbar-expand-lg navbar-light p-0">
                            <div class="navbar-brand clearfix hidden-lg-up">

                                <!-- logo -->
                                <div id="logo-mobile" class="logo">
                                    <a href="..\..\..\..\index.htm">
                                        <img alt="FlashAir logo" src="..\..\..\..\..\images\assets\flashairLogo_official_small2.png">
                                        &nbsp;FlashAir&trade; Developers
                                    </a>
                                </div>

                            </div>
                            <!-- header dropdown buttons -->
                            <div class="header-dropdown-buttons hidden-lg-up p-0 ml-auto mr-3">
                                <div class="btn-group">
                                    <button type="button" class="btn dropdown-toggle dropdown-toggle--no-caret" id="header-drop-3" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <i class="fa fa-search"></i>
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-right dropdown-animation" aria-labelledby="header-drop-3">
                                        <li>
                                            <form role="search" class="search-box margin-clear" id="cse-search-box" action="http://google.com/cse">
                                                <div class="form-group has-feedback">
                                                    <input type="hidden" name="cx" value="015318272157664795635:6mtpckrtgrq">
                                                    <input type="hidden" name="ie" value="UTF-8">
                                                    <input type="text" name="q" size="31" class="form-control">
                                                    <input type="submit" name="sa" value="Search">
                                                </div>
                                            </form>
                                            <script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=ja"></script>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <!-- header dropdown buttons end -->
                            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapse-1" aria-controls="navbar-collapse-1" aria-expanded="false" aria-label="Toggle navigation">
                                <span class="navbar-toggler-icon"></span>
                            </button>

                            <div class="collapse navbar-collapse" id="navbar-collapse-1">
                                <!-- main-menu -->
                                <ul class="navbar-nav ml-xl-auto">
                                    <li class="nav-item dropdown"> <a href="#" class="nav-link dropdown-toggle" id="first-dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Discover</a>
                                        <ul class="dropdown-menu" aria-labelledby="first-dropdown">
                                            <li>
                                                <a href="..\..\..\..\discover\overview\index.htm">What's FlashAir?</a>
                                            </li>
                                            <li>
                                                <a href="..\..\..\..\discover\overview\w04\index.htm">Fourth generation FlashAir W-04</a>
                                            </li>
                                            <li>
                                                <a href="..\..\..\..\discover\gettingstarted\index.htm">Getting Started</a>
                                            </li>
                                            <li>
                                                <a href="..\..\..\..\discover\beginners\index.htm">Beginners Guide with FlashAir
                                                    Development</a>
                                            </li>
                                            <li>
                                                <a href="..\..\..\..\discover\usage\index.htm">Get started with FlashAir</a>
                                            </li>
                                            <li>
                                                <a href="..\..\..\..\discover\app\index.htm">Overview of FlashAir Application
                                                    Development</a>
                                            </li>
                                            <li>
                                                <a href="..\..\..\..\discover\device\index.htm">Overview of using Devices with FlashAir</a>
                                            </li>
                                            <li>
                                                <a href="https://iot-hub.flashair-developers.com/en/" target="_blank">FlashAir
                                                    IoT Hub
                                                    <i class="fa fa-external-link"></i>
                                                </a>
                                            </li>
                                        </ul>
                                    </li>
                                    <li class="nav-item dropdown"> <a href="#" class="nav-link dropdown-toggle" id="second-dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Application</a>
                                        <ul class="dropdown-menu" aria-labelledby="second-dropdown">
                                            <li>
                                                <a href="..\..\..\..\application\iot\index.htm">Application to IoT</a>
                                            </li>
                                            <li>
                                                <a href="..\..\..\..\application\devices\index.htm">Using with Devices</a>
                                            </li>
                                            <li>
                                                <a href="..\..\..\..\application\workflow\index.htm">Improve efficiency of operations</a>
                                            </li>
                                            <li>
                                                <a href="..\..\..\..\application\share-documents\index.htm">Sharing Documents</a>
                                            </li>
                                            <li>
                                                <a href="..\..\..\..\application\users\index.htm">User's Projects</a>
                                            </li>
                                            <li>
                                                <a href="..\..\..\..\application\showcase\index.htm">App Showcase</a>
                                            </li>
                                        </ul>
                                    </li>
                                    <li class="nav-item dropdown active"> <a href="#" class="nav-link dropdown-toggle" id="third-dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Resources</a>
                                        <ul class="dropdown-menu" aria-labelledby="third-dropdown">
                                            <li class="dropdown ">
                                                <a class="dropdown-toggle" data-toggle="dropdown" href="#">Tutorials</a>
                                                <ul class="dropdown-menu to-left">
                                                    <li><a href="..\..\ios\index.htm">iOS</a></li>
                                                    <li><a href="..\..\android\index.htm">Android</a></li>
                                                    <li><a href="..\..\web\index.htm">Web browser</a></li>
                                                    <li><a href="..\..\advanced\index.htm">Advanced</a></li>
                                                    <li><a href="..\..\isdio\index.htm">iSDIO</a></li>
                                                    <li><a href="..\index.htm">Lua</a></li>
                                                    <li><a href="..\..\users\index.htm">User's Tutorials</a></li>
                                                    <li><a href="..\..\iot-hub\index.htm">FlashAir IoT Hub</a></li>
                                                </ul>
                                            </li>
                                            <li class="dropdown ">
                                                <a class="dropdown-toggle" data-toggle="dropdown" href="#">API Guide</a>
                                                <ul class="dropdown-menu to-left">
                                                    <li><a href="..\..\..\api\commandcgi\index.htm">command.cgi</a></li>
                                                    <li><a href="..\..\..\api\configcgi\index.htm">config.cgi</a></li>
                                                    <li><a href="..\..\..\api\thumbnailcgi\index.htm">thumbnail.cgi</a></li>
                                                    <li><a href="..\..\..\api\uploadcgi\index.htm">upload.cgi</a></li>
                                                    <li><a href="..\..\..\api\config\index.htm">CONFIG</a></li>
                                                    <li><a href="..\..\..\api\utility\index.htm">Browser Utility</a></li>
                                                    <li><a href="..\..\..\api\lua\index.htm">Lua Scripting</a></li>
                                                    <li><a href="..\..\..\api\isdio\index.htm">iSDIO</a></li>
                                                    <li><a href="..\..\..\api\fw40003\index.htm">About FW 4.00.03</a></li>
                                                </ul>
                                            </li>
                                            <li>
                                                <a href="..\..\..\resources\index.htm">Developer Resources</a>
                                            </li>
                                            <li>
                                                <a href="..\..\..\books\index.htm">Books</a>
                                            </li>
                                            <li>
                                                <a href="..\..\..\..\about\events\index.htm">Events</a>
                                            </li>
                                        </ul>
                                    </li>
                                    <li class="nav-item dropdown"> <a href="#" class="nav-link dropdown-toggle" id="fourth-dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Support</a>
                                        <ul class="dropdown-menu" aria-labelledby="fourth-dropdown">
                                            <li>
                                                <a href="..\..\..\..\support\index.htm">Support</a>
                                            </li>
                                            <li>
                                                <a href="..\..\..\..\support\forum\index.htm">Developer Forum</a>
                                            </li>
                                            <li>
                                                <a href="..\..\..\..\support\faq\index.htm">FAQ</a>
                                            </li>
                                            <li>
                                                <a href="..\..\..\..\support\iot-hub\index.htm">About FlashAir IoT Hub service end</a>
                                            </li>
                                            <li>
                                                <a href="..\..\..\..\support\developers\index.htm">About FlashAir Developers site closure</a>
                                            </li>                
                                        </ul>
                                    </li>
                                </ul>
                                <!-- main-menu end -->
                            </div>
                        </nav>
                    </div>
                    <!-- main-navigation end -->
                </div>
                <!-- header-second end -->

            </div>
            <div class="col-auto hidden-md-down">
                <!-- header dropdown buttons -->
                <div class="header-dropdown-buttons">
                    <div class="btn-group">
                        <button type="button" class="btn dropdown-toggle dropdown-toggle--no-caret" id="header-drop-1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="fa fa-search"></i>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-right dropdown-animation" aria-labelledby="header-drop-3">
                            <li>
                                <form role="search" class="search-box margin-clear" id="cse-search-box" action="http://google.com/cse" target="_blank">
                                    <div class="form-group has-feedback">
                                        <input type="hidden" name="cx" value="015318272157664795635:6mtpckrtgrq">
                                        <input type="hidden" name="ie" value="UTF-8">
                                        <input type="text" name="q" size="31" class="form-control">
                                        <input type="submit" name="sa" value="Search">
                                    </div>
                                </form>
                                <script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=ja"></script>
                            </li>
                        </ul>
                    </div>
                </div>
                <!-- header dropdown buttons end -->
            </div>
        </div>
    </div>
    <!-- header end -->
    <!-- Google Analytics Tracking Code -->
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-498925-24', 'auto');
        ga('send', 'pageview');
    </script>
</header>
        </div>
        <!-- header-container end -->

        <!-- main-container start -->
        <!-- ================ -->
        <section class="main-container">

            <div class="container">
                <div class="row">

                    <!-- main start -->
                    <!-- ================ -->
                    <div class="main col-lg-9 order-lg-2 pb-5">

                        <!-- page-title start -->
                        <!-- ================ -->
                        <h1 class="page-title">
                            Uploading to Facebook</h1>
                        <p class="small text-muted">Latest update: May 2015</p>
                        <!-- page-title end -->

                        <p class="mt-5">In this tutorial, we&#8217;ll go over uploading to Facebook. We have already
                            released a sample
                            <a href="..\..\..\api\lua\sample\index.htm">Facebook script</a>, so instead of creating a new
                            one we&#8217;re going to go over how it works.
                        </p>
                        <h2 id="_facebook_html" class="mt-1">Facebook.html</h2>
                        <div class="separator-2"></div>
                        <p>Facebook.html uses javascript to redirect the user to Facebook&#8217;s OAuth service.
                            It&#8217;s
                            just used to get the Authentication Token.</p>
                        <h2 id="_fb_get_token_lua" class="mt-1">fb_get_token.lua</h2>
                        <div class="separator-2"></div>
                        <p>This script is used to get the "long term" access token (the one that lasts 60 days, as
                            opposed to
                            only 1 hour).</p>
                        <p>First, it uses
                            <a href="..\..\..\api\lua\index.htm#request">fa.request</a> and cjson to confirm that the
                            current access token (the 1 hour version) is still
                            valid.
                        </p>
                        <pre class="prettyprint lang-lua"><code>local function hasValidToken(t)
    local b, c, h = fa.request {
        url = 'https://graph.facebook.com/debug_token?input_token='
            ..t.user_access_token..'&amp;access_token='
            ..t.app_access_token,
        headers = {Connection = 'close'}
    }
    if (c == 200) then
        local cjson = require("cjson")
        local res = cjson.decode(b)
        cjson = nil
        if (res.error ~= nil) then
            t.message = res.error.message
        else
            t.long_term = res.data.issued_at
            if (res.data.error ~= nil) then
                t.message = res.data.error.message
            else
                t.message = res.data.message
            end
        end
        return res.data.is_valid
    else
        t.message = b
        return false
    end
end</code></pre>
                        <p>It checks the response code (c) first, and if it&#8217;s "200" (a success) will move on to
                            deconding
                            the JSON response. If any of these steps fail, the user does not have a valid token, and
                            "showAuthorizationURL()"
                            will be called - which prints a formatted string directing the user to get a new key.</p>
                        <p>If hasValidToken returns "true", we move on to requesting the long term token. Here we again
                            use
                            fa.request to call facebook&#8217;s OAuth API. We pass out app&#8217;s token as well as the
                            temporary
                            access token, and it (should) reply with the 60 day version (which is stored and later
                            printed
                            for the user).</p>
                        <pre class="prettyprint lang-lua"><code>local function getLongtermToken(t)
  local b, c, h = fa.request {
    url = 'https://graph.facebook.com/oauth/access_token?grant_type=fb_exchange_token'
      ..'&amp;client_id='..t.app_id
      ..'&amp;client_secret='..t.app_secret
      ..'&amp;fb_exchange_token='..t.user_access_token,
    headers = {Connection = 'close'}
  }

  if (c == 200) then
    local s, e = b:find("&amp;")
    local longtermToken = b:sub(1, s - 1)
    local file = io.open( t.token_fullpath, "w" )
    file:write( longtermToken )
    io.close( file )
    file = nil

    s, e = longtermToken:find("=")
    -- Store the returned token
    t.user_access_token = longtermToken:sub(e+1, #longtermToken)
  end
end</code></pre>
                        <h2 id="_fb_token_handler_lua" class="mt-1">fb_token_handler.lua</h2>
                        <div class="separator-2"></div>
                        <p>This script manages reading the config file (facebook.cfg) for fb_get_token.lua. It returns
                            a table
                            (mod) containing the results.</p>
                        <h2 id="_fb_auto_up_lua" class="mt-1">fb_auto_up.lua</h2>
                        <div class="separator-2"></div>
                        <p>Finally, this script uploads to Facebook. First, it waits for WiFi to be connected
                            (waitWlanConnect()),
                            and when it is connected goes through each folder in the upload directory and uploads them
                            one
                            file at a time.
                        </p>
                        <p>LuaFileSystem is used to find and select each file (autoUpload()).</p>
                        <pre class="prettyprint lang-lua"><code>--...
--For each directory...
for aDirectory in lfs.dir("/DCIM") do
        local _dir_id = tonumber(aDirectory:sub(1, 3))
--        print("DIR:"..aDirectory, lfs.attributes("/DCIM/"..aDirectory, "modification"))
        if (_dir_id ~= nil and _dir_id &gt;= lastDirectory) then
	    --for each file in that directory...
            for aFile in lfs.dir("/DCIM/"..aDirectory) do
	        --Process and upload!
--...</code></pre>
                        <p>Next, before uploading a folder it uses Facebook&#8217;s Graph API to create an album. This
                            is done
                            with a basic
                            <a href="..\..\..\api\lua\index.htm#request">fa.request</a> call, then it decodes the response
                            string to get the album ID (which we need to
                            make sure we upload to the right place).</p>
                        <pre class="prettyprint lang-lua"><code>local function createAlbum(_name, _message)
    local req = {}
    req["url"] = 'https://graph.facebook.com/v2.1/me/albums?access_token='..user_access_token
        ..'&amp;name='..string.gsub (_name, " ", "+")
        ..'&amp;message='..string.gsub (_message, " ", "+")
        ..'&amp;privacy=%7B%22value%22%3A+%22SELF%22%7D'
    req["method"] = 'POST'
    req["headers"] = {Connection = "close"}

    local b,c,h = fa.request(req)
    if (c ~= 200) then
        print(h, b)
        return nil
    end
    req = nil

    c, h = nil
    local cjson = require("cjson")
    local res = cjson.decode(b)
    collectgarbage()
    return res["id"]
end</code></pre>
                        <p>Finally, each file is uploaded (uploadFile(filePath, _album_id)) using
                            <a href="..\..\..\api\lua\index.htm#request">fa.request</a> to send a POST request.</p>
                        <pre class="prettyprint lang-lua"><code>local function uploadFile(filePath, _album_id)
    local boundary = '--bnfDxpKY69NKk'
    local headers = {}
    local place_holder = '&lt;!--WLANSDFILE--&gt;'

    headers['Connection'] = 'close'
    headers['Content-Type'] = 'multipart/form-data; boundary="'..boundary..'"'

    local body = '--'..boundary..'\r\n'
        ..'Content-Disposition: form-data; name="source"; filename="'
        ..filePath..'"\r\n'
        ..'Content-Type: image/jpeg\r\n\r\n'
        ..'&lt;!--WLANSDFILE--&gt;\r\n'
        .. '--' .. boundary .. '--\r\n'

    headers['Content-Length'] =
        lfs.attributes(filePath, 'size')
        + string.len(body)
        - string.len(place_holder)

    local args = {}
    args["url"] = 'https://graph.facebook.com/v2.1/'
            .._album_id..'/photos?access_token='
            ..user_access_token
            ..'&amp;message='..filePath
    args["method"] = "POST"
    args["headers"] = headers
    args["body"] = body
    args["file"] = filePath
    args["bufsize"] = 1460*10
    local b,c,h = fa.request(args)
    b, h = nil
    collectgarbage()
    if (c ~= 200) then
        print(h, b)
        return nil
    end
    return c
end</code></pre>
                        <p>Uploading can take quite some time!</p>

                        <p>
                            <p class="small">All sample code on this page is licensed under
                                <a href="..\..\..\license\index.htm" target="_blank">BSD 2-Clause License</a>
                            </p>
                        

                        <!-- Social Buttons -->
                        <div class="clearfix">
	<ul class="social-links float-right">
		<li class="twitter">
			<!--Tweet Button-->
			<a href="https://twitter.com/share" class="twitter-share-button" {count}="" data-via="FlashAirDev" data-related="FlashAirDev">Tweet</a>
			<script>
				! function (d, s, id) {
					var js, fjs = d.getElementsByTagName(s)[0],
						p = /^http:/.test(d.location) ? 'http' : 'https';
					if (!d.getElementById(id)) {
						js = d.createElement(s);
						js.id = id;
						js.src = p + '://platform.twitter.com/widgets.js';
						fjs.parentNode.insertBefore(js, fjs);
					}
				}(document, 'script', 'twitter-wjs');
			</script>
		</li>
		<li class="facebook">
			<!--Facebook Like Button-->
			<div id="fb-root"></div>
			<script>
				(function (d, s, id) {
					var js, fjs = d.getElementsByTagName(s)[0];
					if (d.getElementById(id)) return;
					js = d.createElement(s);
					js.id = id;
					js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
					fjs.parentNode.insertBefore(js, fjs);
				}(document, 'script', 'facebook-jssdk'));
			</script>
			<div class="fb-like" data-href="https://www.flashair-developers.com/" data-send="false" data-layout="button_count" data-width="450" data-show-faces="false" data-font="verdana"></div>
		</li>		
	</ul>
</div>

                        <!-- pagination start -->
                        <nav aria-label="Page navigation">
                            <ul class="pagination justify-content-between">
                                <li>
                                    <a class="btn radius-50 page-link badge-pill" href="..\4\index.htm" aria-label="Previous">
                                        <i class="fa fa-chevron-left pr-10"></i>
                                        Uploading a file with FTP
                                    </a>
                                </li>
                                <li>
                                    <a class="btn radius-50 page-link badge-pill" href="..\6\index.htm" aria-label="Next">
                                        Uploading a file to Dropbox, with OAUTH2
                                        <i class="fa fa-chevron-right pl-10"></i>
                                    </a>
                                </li>
                            </ul>
                        </nav>
                        <!-- pagination end -->

                        <!-- Amazon bottom link -->
                        <div class="col-12">
	<!--Amazon search result for tablet-->
	<div class="amazon-widget-bottom mx-auto d-none d-md-block d-lg-none">
		<!--
<iframe src="http://rcm.amazon.com/e/cm?t=flasdeve-20&o=1&p=12&l=st1&mode=photo&search=toshiba%20flashair&fc1=333333&lt1=_blank&lc1=009BDD&bg1=FFFFFF&f=ifr" marginwidth="0" marginheight="0" width="300" height="250" border="0" frameborder="0" style="border:none;" scrolling="no"></iframe>
-->
		<div class="amazon-content" marginwidth="0" marginheight="0" width="320" height="250" border="0" frameborder="0" style="border: none;" scrolling="no"></div>
	</div>

	<!--Amazon search result for smartphone-->
	<div class="amazon-widget-mobile mx-auto d-md-none">
		<!--Image-->
		<!--
	<a href="http://www.amazon.com/gp/product/B009RGP7HY/ref=as_li_tf_il?ie=UTF8&camp=1789&creative=9325&creativeASIN=B009RGP7HY&linkCode=as2&tag=flasdeve-20" alt="TOSHIBA FlashAir SD card 8GB SD-WB008G"><img src="http://ws.assoc-amazon.com/widgets/q?_encoding=UTF8&ASIN=B009RGP7HY&Format=_SL110_&ID=AsinImage&MarketPlace=US&ServiceVersion=20070822&WS=1&tag=flasdeve-20" style="vertical-align:middle;"/></a><br>
-->
		<!--Text-->
		<!--
<a href="http://www.amazon.com/gp/product/B009RGP7HY/ref=as_li_tf_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=B009RGP7HY&linkCode=as2&tag=flasdeve-20">Find TOSHIBA FlashAir SD card 8GB SD-WB008G on Amazon.com</a><img src="http://www.assoc-amazon.com/e/ir?t=flasdeve-20&l=as2&o=1&a=B009RGP7HY" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
-->
		<div class="amazon-content" marginwidth="0" marginheight="0" border="0" frameborder="0" style="border: none;" scrolling="no"></div>
	</div>
</div>

                    </div>
                    <!-- main end -->

                    <!-- sidebar start -->
                    <!-- ================ -->
                    <aside class="col-lg-3 col-xl-3 order-lg-1">
                        <div class="sidebar">
  <div class="block clearfix">
    <nav>
      <ul class="nav flex-column">
        <li class="nav-item"> <a class="nav-link" href="..\1\index.htm">
          An introduction to Lua on FlashAir
          </a>
        </li>

        <li class="nav-item"> <a class="nav-link" href="..\2\index.htm">
          Running Lua on your FlashAir!
          </a>
        </li>

        <li class="nav-item"> <a class="nav-link" href="..\3\index.htm">
          Downloading a file via HTTP
          </a>
        </li>

        <li class="nav-item"> <a class="nav-link" href="..\4\index.htm">
          Uploading a file with FTP
          </a>
        </li>

        <li class="nav-item active"> <a class="nav-link active" href="index.htm">
          Uploading to Facebook
          </a>
        </li>

        <li class="nav-item"> <a class="nav-link" href="..\6\index.htm">
          Uploading a file to Dropbox,<br class="d-none d-md-block"> with OAUTH2
          </a>
        </li>

        <li class="nav-item"> <a class="nav-link" href="..\7\index.htm">
          WiFi configuration
          </a>
        </li>

        <li class="nav-item"> <a class="nav-link" href="..\8\index.htm">
          Creating a Web interface with Lua
          </a>
        </li>

        <li class="nav-item"> <a class="nav-link" href="..\9\index.htm">
          Uploading to Google Drive with Lua
          </a>
        </li>

        <li class="nav-item"> <a class="nav-link" href="..\10\index.htm">
          Compile Lua script into bytecode
          </a>
        </li>
        <li>
          <br>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="..\index.htm">
            Back to Content List
          </a>
        </li>

      </ul>
    </nav>
  </div>
</div>

<!-- Amazon side link -->
<!--Amazon search result for desktop-->
<div class="amazon-widget-side d-none d-lg-block">
	<!--
	<iframe src="http://rcm.amazon.com/e/cm?t=flasdeve-20&o=1&p=14&l=st1&mode=photo&search=toshiba%20flashair&fc1=333333&lt1=_blank&lc1=009BDD&bg1=FFFFFF&f=ifr" marginwidth="0" marginheight="0" width="160" height="600" border="0" frameborder="0" style="border: medium none; float: right; font-size: 14px;" scrolling="no"></iframe>
	-->
	<div class="amazon-content" marginwidth="0" marginheight="0" width="160" height="600" border="0" frameborder="0" style="border: medium none; float: right; font-size: 14px;" scrolling="no"></div>
</div>
                    </aside>
                    <!-- sidebar end -->

                </div>
            </div>
        </section>
        <!-- main-container end -->

        <!-- footer start -->
        <!-- ================ -->
        <!-- footer start -->
<!-- ================ -->
<footer id="footer" class="clearfix ">

  <!-- .footer start -->
  <!-- ================ -->
  <div class="footer">
    <div class="container">
      <div class="footer-inner">
        <div class="row">
          <div class="col-lg-4">
            <div class="footer-content">
              <h2 class="title">
                <img alt="FlashAir logo" src="..\..\..\..\..\images\assets\flashairLogo_official_small2.png"> FlashAir&trade; Developers</h2>
              <div class="separator-2"></div>
              <p>
                  A technical information website for developers of Toshiba FlashAir apps or services. FlashAir Developers is operated by Fixstars in cooperation with Toshiba Memory Corporation. To learn more about Fixstars, visit
                <a target="_blank" href="http://www.fixstars.com">www.fixstars.com
                  <i class="fa fa-external-link"></i>
                </a>. ?FlashAir is a trademark of Toshiba Memory Corporation.
              </p>
              <ul class="social-links circle animated-effect-1" style="margin-bottom: 10px">
                <li class="facebook">
                  <a href="https://www.facebook.com/FlashAir-Developers-115819238627364/" target="_blank">
                    <i class="fa fa-facebook"></i>
                  </a>
                </li>
                <li class="twitter">
                  <a href="https://twitter.com/FlashAirDev/" target="_blank">
                    <i class="fa fa-twitter"></i>
                  </a>
                </li>
              </ul>
              <ul class="list-unstyled list-inline m-0">
                <li class="list-inline-item"><a href="..\..\..\..\terms-of-use\index.htm">Terms of Use</a></li>
                <li class="list-inline-item">|</li>
                <li class="list-inline-item"><a href="..\..\..\..\privacypolicy\index.htm">Privacy Policy</a></li>
              </ul>
            </div>
          </div>
          <div class="col-lg-4">
            <div class="footer-content">
              <h2 class="title">Twitter</h2>
              <div class="separator-2"></div>
              <div id="twitterWidget">
                <a class="twitter-timeline" data-theme="light" href="https://twitter.com/FlashAirDev" data-widget-id="344743426811641856" height="230" data-chrome="nofooter noheader noborders transparent">Latest News</a>
                <script>
                  ! function (d, s, id) {
                    var js, fjs = d.getElementsByTagName(s)[0],
                      p = /^http:/.test(d.location) ? 'http' : 'https';
                    if (!d.getElementById(id)) {
                      js = d.createElement(s);
                      js.id = id;
                      js.src = p + "://platform.twitter.com/widgets.js";
                      fjs.parentNode.insertBefore(js, fjs);
                    }
                  }(document, "script", "twitter-wjs");
                </script>
              </div>
            </div>
          </div>
          <div class="col-lg-4">
            <div class="footer-content">
              <h2 class="title">Sitemap</h2>
              <div class="separator-2"></div>
              <nav>
                <ul class="nav flex-column">
                  <li class="nav-item">
                    <a class="nav-link" href="..\..\..\..\discover\overview\index.htm">What's FlashAir?
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="..\..\..\resources\index.htm">Developer Resources
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="..\..\index.htm">Tutorials
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="..\..\..\api\index.htm">API Guide
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="..\..\..\..\support\index.htm">Support
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="..\..\..\..\support\forum\index.htm">Developer Forum
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="https://iot-hub.flashair-developers.com/en/" target="_blank">FlashAir IoTHub <i class="fa fa-external-link"></i>
                    </a>
                  </li>
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- .footer end -->

  <!-- .subfooter start -->
  <!-- ================ -->
  <div class="subfooter">
    <div class="container">
      <div class="subfooter-inner">
        <div class="row">
          <div class="col-md-12">
            <p class="text-center">Copyright &copy; 2019 FlashAir Developers. All rights reserved.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- .subfooter end -->

  <div id="overlay">
    <div class="container">
      <div class="row">
        <div class="col-md-10 ml-auto text-white">
          <p class="mt-3">If you write software or change the settings which are described on this site to your FlashAir device which was purchased at a mass retailer or online shop, it will not be eligible for a free replacement under the warranty policy. Please acknowledge and carry out development at your own risk.
          </p>
        </div>
        <div class="col-md-2 row">
          <div class="align-self-center">
          <button class="btn btn-default" id="btn-agree">Accept</button>
        </div>
        </div>
      </div>
    </div>
  </div>

</footer>
<!-- footer end -->

<!-- JavaScript files placed at the end of the document so the pages load faster -->
<!-- ================================================== -->
<!-- Jquery and Bootstap core js files -->
<script src="..\..\..\..\..\js\jquery.min.js"></script>
<script src="..\..\..\..\..\js\bootstrap.bundle.min.js"></script>
<!-- jQuery Revolution Slider  -->
<script src="..\..\..\..\..\js\jquery.themepunch.tools.min.js"></script>
<script src="..\..\..\..\..\js\jquery.themepunch.revolution.min.js imagesloaded.pkgd.min.js.pagespeed.jc.cG4Ou2l09T.js"></script><script>eval(mod_pagespeed_faLzhRoycV);</script>
<!-- Isotope javascript -->
<script>eval(mod_pagespeed_e7p3yiKri5);</script>
<script src="..\..\..\..\..\js\isotope.pkgd.min.js jquery.magnific-popup.min.js jquery.waypoints.min.js sticky.min.js jquery.countTo.js.pagespeed.jc.cWqBgip635.js"></script><script>eval(mod_pagespeed_EzjKnImtZK);</script>
<!-- Magnific Popup javascript -->
<script>eval(mod_pagespeed_hr4XVzGccf);</script>
<!-- Appear javascript -->
<script>eval(mod_pagespeed_zhicDWZgIJ);</script>
<script>eval(mod_pagespeed_MTpYywWOfL);</script>
<!-- Count To javascript -->
<script>eval(mod_pagespeed_dmh3ejQ5o0);</script>
<!-- Slick carousel javascript -->
<script src="..\..\..\..\..\js\slick.min.js pace.min.js template.js jquery.cookie.js custom.js jquery.matchHeight.js.pagespeed.jc.Y3630FlbPX.js"></script><script>eval(mod_pagespeed_s1mKdTeuWx);</script>
<!-- Pace javascript -->
<script>eval(mod_pagespeed_Zs67JgCVyk);</script>
<!-- Initialization of Plugins -->
<script>eval(mod_pagespeed_BIPkzwMbEw);</script>
<!-- Custom Scripts -->
<script>eval(mod_pagespeed_uSq_SD1Gz5);</script>
<script>eval(mod_pagespeed_mqKjjurRp4);</script>
<script>eval(mod_pagespeed_TteNs$c3Zl);</script>
<script>
  $(function () {
    $('.matchHeight').matchHeight();
  });
</script>
<script src="..\..\..\..\..\js\script.js prettify.js lang-lua.js lang-css.js.pagespeed.jc.ECF3Z77mjV.js"></script><script>eval(mod_pagespeed_SrZ0Yqg7MZ);</script>
<script>eval(mod_pagespeed_RSPiDhly$4);</script>
<script>eval(mod_pagespeed_0pGoVUEAt9);</script>
<script>eval(mod_pagespeed_IrbA2eGHA$);</script>
<script>
  ! function ($) {
    $(function () {
      PR.prettyPrint()
    })
  }(window.jQuery)
</script>
        <!-- footer end -->
    </div>
    <!-- page wrapper end -->
</body>

</html>